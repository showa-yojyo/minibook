Chapter 10 Data Analysis
======================================================================

Introduction
----------------------------------------------------------------------

関連機能はメインメニュー :menuselection:`&Data` と :menuselection:`&Tools` に分
散している。

Consolidating data
----------------------------------------------------------------------

複数のワークシートに散在しているデータを結合して集計する機能として
:menuselection:`&Data --> &Consolidate...` コマンドがある。これを実行すると
:guilabel:`Consolidate` ダイアログが開く。この使い方が自力ではわからない。

* :guilabel:`&Function` ドロップダウンリストから所望の集計関数を指定する。
* :guilabel:`&Source data ranges` 欄を指定する。それから :guilabel:`Add` ボタン
  を押して選択範囲を :guilabel:`Consolidation ranges` 一覧に追加する。この追加処
  理を所望の範囲をカバーするまで反復する。
* :guilabel:`Copy results &to` 欄を指定する。

:guilabel:`OK` を押して処理を実行する。指定した場所にある値を集計関数に入力とし
て渡して評価し、指定した場所に出力する。

Consolidation settings
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

ダイアログ上のプラスマークをクリックすると、詳細オプション項目群が現れる。

ラベル系オプションは選択範囲それぞれの最初の列や最初の行がフィールドである場合、
かつそれらがすべて一致している場合にはオンにするのが自然だろう。

:guilabel:`&Link to source data` をオンにすると、:guilabel:`&Source data ranges`
の値が変化すると :guilabel:`Copy results &to` の値も自動的に更新される。

Consolidation example
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

ガイド本文のデータを手で再現して Consolidation コマンドの動作を体で理解しろ。

   The source ranges and target range are saved as part of the document. If you
   later open a document with consolidated ranges, they will still be available
   in the Consolidation ranges list of the Consolidate dialog.

Creating subtotals
----------------------------------------------------------------------

小計を得る方法は二つだ：

* ``SUBTOTAL`` 関数
* :menuselection:`&Data --> Sub&totals...` コマンド

Using the ``SUBTOTAL`` function
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

``SUBTOTAL`` 関数は Function Wizard の数学区分とサイドバーの関数デッキの下に一覧
されている。本関数はわずかな区分だけで使用する場合に効果的だ。

ガイド本文のデータを手で再現して Sales Value の列の下のセルに ``SUBTOTAL`` 呼び
出しを埋める。急所は、自動フィルターで例えば Employee を Brigitte に絞り込むと、
それに応じて ``SUBTOTAL`` の値が更新されることにある。

* ``SUBTOTAL`` の第一引数の謎数値が計算の種類を指す。
* 列の下に出力セルを設けると、当然だが自動フィルター適用時にそれが隠れる。
  ``SUBTOTAL`` の動作を試すときにはどう絞り込んでも隠れないセルに書け。

The Subtotals tool
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

コマンドのほうはラベル付きの列に配置された高々三つの配列の小計を実行可能だ。さら
に、自動フィルターを適用し、手作業で絞り込む必要がないように機能する。

対象データ全体を選択（列見出しラベル含む）してからメインメニュー
:menuselection:`&Data --> Sub&totals...` を実行する。:guilabel:`Subtotals` ダイ
アログボックスが開く。項目を指定する：

* :guilabel:`&Group by` には小計グループフィールドを指定する
* :guilabel:`&Calculate subtotals for` には数値計算の対象フィールドを指定する
* 必要なら :guilabel:`2nd Group`, :guilabel:`3rd Group` タブの内容も指定する

----

実行直後、ワークシート行番号列の左にアウトラインが現れる。このアウトラインは小計
の階層構造を表す。

* アウトラインの上部にある番号
* またはプラス :guilabel:`+` とマイナス :guilabel:`-` 記号

を使用して、階層内の別階層データ表示を切り替える。アウトラインの表示切り替えには
次のコマンドがある：

* :menuselection:`&Data --> &Group and Outline --> &Remove Outline`
* :menuselection:`&Data --> &Group and Outline --> &AutoOutline`

アウトラインの左側ほど総計の、右側ほど小計の度合いがそれぞれ強まる。

----

:guilabel:`Options` タブに小計オプションがいろいろある。

----

:guilabel:`Subtotals` ダイアログボックスで、

* 現在のタブで行った変更を元に戻すには :guilabel:`Reset` ボタンを押す。
* 作成済みの小計を削除するには :guilabel:`Remove` ボタンを押す。

Using scenarios
----------------------------------------------------------------------

計算に対する異なる条件の影響を検査する必要があるが、反復する手動データ入力を処理
したくない場合に有用な機能だ。

Creating scenarios
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

対象セル（最低二つ）を選択してメインメニュー :menuselection:`&Tools -->
Sc&enario...` を実行すると :guilabel:`Create Scenario` ダイアログボックスが開
く。

* シナリオは通常複数作成するので、名前はまともに付けろ。
* どの計算がシナリオに依存しているかを追跡するには、シナリオセル上でメインメ
  ニュー :menuselection:`&Tools --> &Detective --> &Trace Depenendents` を実行す
  ると良い。
* 対象セルはどこにあってもかまわない。散在していてもいい。

Scenario settings
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

:guilabel:`Create Scenario` ダイアログボックスのオプション項目はそれほど使わな
い？

:guilabel:`&Display border` をオフにするとワークシート内で紛れる。オンにするべき
だろう。

Changing scenarios
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

シナリオ関連の記述では、ワークシートとセルの保護という言葉が何度も述べられている
ことに注意。次の四項目のオンオフ状態の組み合わせで、変更が許可されるかどうかが決
まる：

* ワークシートに対する保護
* シナリオセルに対する保護
* :guilabel:`Copy &back`
* :guilabel:`&Prevent changes`

いちばんわかりやすいのはワークシート保護がオフの場合だ。シナリオセルの値は変更可
能で、シナリオは :guilabel:`Copy &back` の設定次第で更新可能性が決まる。残りの組
み合わせはガイド本文を参照するしかない。

Working with scenarios using the Navigator
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

ワークシートにシナリオを追加した後、特定のシナリオを表示するには、まず
:guilabel:`Navigator`ダイアログボックスを次のいずれかの方法で開く：

* :menuselection:`&View --> Na&vigator`
* :kbd:`F5`

それから :guilabel:`Scenarios` 図像をクリックしろ。

現在のワークシートにシナリオを適用するには、当該シナリオ名をダブルクリックしろ。
動作が遅いのが気になる。

シナリオを削除する方法は次のいずれか：

* シナリオ名の右クリックメニューから :menuselection:`&Delete` を実行する。
* シナリオ名を選択し :kbd:`Del` を押す。

シナリオを編集するには、シナリオ名の右クリックメニューから
:menuselection:`&Properties...` を実行する。シナリオ作成時のものとよく似た
:guilabel:`Edit Scenario` ダイアログボックスが開く。

Using the Multiple Operations tool
----------------------------------------------------------------------

データを単一ワークシートにまとめ、数式、変数、表の範囲をラベルで識別するようにす
ると、このコマンドは使いやすいとある。

Multiple Operations with one formula and one variable
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

一数式一変数の場合が基本だ。:menuselection:`&Data --> &Multiple Operations...`
コマンドを実行する準備手順はこうだ：

#. ワークシートのセルに、数式と、それが用いる変数を一つ以上入力する。
#. 同じワークシートで、列または行を占めるセル範囲（変数範囲）に値を入力する。
#. 今定義した変数範囲と、それに続く隣接した空セルの両方を含む範囲を選択する。変
   数範囲がどのように配列されているかによって、これらの空セルは、右の列（範囲
   が列の場合）か、すぐ下の行（行の場合）のいずれかになる。

これで :guilabel:`Multiple Operations` ダイアログボックスが開く。

* :guilabel:`Formulas` には上述の最初手順で定義した（数式への）セル参照を指定す
  る。
* 上述の変数範囲が列型ならば :guilabel:`&Column input cell` に、行型ならば
  :guilabel:`&Row input cell` に使用したい変数へのセルを指定する。

:guilabel:`&OK` をクリックして実行する。指定の空セルに結果が得られる。各結果値
は、それに隣接する変数値に対応し、一緒になって結果表を形成する。

----

ガイド本文の例の状況：

* B1: 単価 10 ドルで販売する玩具を生産しているとする
* B2: 各項目の製造費用は 2 ドル
* B3: 年間固定コストは 10,000 ドル
* B4: 販売数量の最初の見積もりは 2,000 個

だとしている。問題は、収支を均衡させるために何個の玩具を販売する必要があるか、
だ。この問題を解く手順はこうなる：

#. セル B5 に数式 ``=B4*(B1-B2)-B3`` を入力する。単純な一次式だ。
#. 例えばセル D2:D11 に 500 から 5000 までの値を 500 刻みで入力しておく。
#. セル D2:E11 を選択して :menuselection:`&Data --> &Multiple Operations...` を
   実行する

ダイアログボックスの指定はこのようにする：

* :guilabel:`&Formulas` にはセル B5 を指定
* :guilabel:`&Column input cell` にはセル B4 を指定

:guilabel:`&OK` をクリックすると空セルが埋まり、損益分岐が目視確認可能になる。

Calculating with several formulas simultaneously
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

数式を複数にすることも可能だ。

* 数式の個数ぶんだけ対応する列・行を出力表に用意する必要がある。
* たとえば、数式 A, B, C をこの順序で一行に並べた場合、出力は表の一列目、二列
  目、三列目に A, B, C の順で格納される。

----

本文では、直前の販売データの例に年間全体の利益に加え、販売した商品ごとの年間利益
を計算する問題を解いている。

* セル C5 に ``=B5/B4`` を入力
* セル D2:F11 を選択して :menuselection:`&Data --> &Multiple Operations...` を実
  行する

ダイアログボックスの指定はこのようにする：

* :guilabel:`&Formulas` にはセル B5:C5 を指定
* :guilabel:`&Column input cell` にはセル B4 を指定（変わらず）

.. admonition:: 利用者ノート

   :guilabel:`&Column input cell` の指定を間違いやすい。

Multiple operations with two variables
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

二変数で Multiple Operations を使用すると、二次元の結果表が得られる。変数それぞ
れが表の次元の一つを定義し、両方の変数の交代値がそれぞれ表の行見出しと列見出しに
なる。表の各セルは、行見出し値と列見出し値の個別の対に対応する。

順序が重要であって、:guilabel:`&Column input cell` 欄は行見出しの値に対応
し、:guilabel:`&Row input cell` 欄は列見出しの値に対応する。

二変数を使用する場合、Multiple Operations は複数の数式では機能しない。

----

最後の例では販売数と販売単価を変数にする。手順の変更点をまとめる：

* セル E1:H1 に直に値 8, 10, 15, 20 を入力する
* セル D1:H11 を選択してコマンドを起動

ダイアログボックスの指定が増える：

* :guilabel:`&Row input cell` に B1 を指定する。これにより、8, 10, 15, 20 が B1
  で定義された単価変数と連動する。
* :guilabel:`&Column input cell` には従来どおり B4 を指定する。これは 500, ...,
  5000 のセルが販売量変数 B4 に連動することを意味する。

Using Goal Seek
----------------------------------------------------------------------

Using the Solver
----------------------------------------------------------------------
