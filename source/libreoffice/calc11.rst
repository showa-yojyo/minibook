======================================================================
Calc Guide Chapter 11 Linking Data ノート
======================================================================

.. contents::
   :local:

Using multiple sheets
======================================================================

Why use multiple sheets?
----------------------------------------------------------------------

ワークシート同士に何らかの関係が定義されれば、情報表現が強力になるだろう。

今さらだが、Calc がスプレッドシートという術語を用いる場合、それは MS Excel で言
うところのワークブックに対応する概念だ。

Setting up multiple sheets
----------------------------------------------------------------------

スプレッドシートに複数のシートを設定する方法は Chapter 1 で学習した。

Identifying sheets
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

新規スプレッドシートを開くと、:guilabel:`Sheet1` という名前のシートが一枚含まれ
る。この挙動を Calc オプション :menuselection:`LibreOffice Calc --> Defaults` で
変更可能だ：

* 新規文書が含むシートの数
* 新規シートの接頭辞

スプレッドシートの下部にあるタブを使ってシートを管理する。

Inserting new sheets
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

複数ある方法のどれを選ぶかは利用者次第だ。

* シートタブ左の :guilabel:`+` をクリックする
* メニューから :menuselection:`&Sheet --> Insert &Sheet...` を実行する
* メニューから :menuselection:`&Sheet --> Insert Sheet at End` を実行する
* メニューから :menuselection:`&Sheet --> Insert Shee&t from File...` を実行する
* シートタブ右クリックメニューから :menuselection:`Insert &Sheet...` を実行する

これらの方法のうち :guilabel:`Insert Sheet` ダイアログボックスが開くものについて
は、次のオプションを使ってもよい：

* 新規シートの挿入位置を現在シートの前か次のいずれにするか
* 新規シートの枚数
* 新規シートがただ一枚の場合に限り、新規シートの名前

または :guilabel:`Append Sheet` ダイアログボックスが開くものについては、新規シー
トの :guilabel:`&Name` を既定の名前以外のものに指定可能だ。

本文のチュートリアル？は気が向いたら実施すればいい。明らかに容易な課題だ。

Inserting sheets from a different spreadsheet
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

さらに、:guilabel:`Insert Sheet` ダイアログボックスには :guilabel:`&From file` オ
プションがある。シートを追加する手順は：

1. :guilabel:`&Browse...` ボタンを押すとファイルダイアログボックスが開く
2. 別の Calc ファイルなどを選択する
3. シート一覧が現れる
4. 追加するシートを選択する

:guilabel:`&Link` をオンにすると、参照様式がシートのコピーではなくリンクになる。

* 他のスプレッドシートから生きたデータを取り込むことを実現する。
* リンクを更新するには :menuselection:`&Edit --> Lin&ks to External Files...` を
  実行する。
* 自動更新にしたければオプション設定だ。:menuselection:`LibreOffice Calc -->
  General` の :guilabel:`Update links when opening` ラジオボタングループを好みの
  項目に変えろ。

Renaming sheets
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

シートには意味がある名前を与えろ。既存シートの名前を変える方法：

* シートタブをダブルクリックする
* シートタブを :kbd:`Alt` を押しながらクリックする
* シートタブ右クリックメニューから :menuselection:`Rename S&heet...` を実行する
* メニューから :menuselection:`&Sheet --> Rename S&heet...` を実行する

以上のいずれの操作でも :guilabel:`Rename Sheet` ダイアログボックスが開く。ここで
新しい名前を :guilabel:`&Name` 欄に入力しろ。

Referencing other sheets
----------------------------------------------------------------------

他のシートのセルを参照する方法は二つはある：

* キーボードを使って数式を直接入力する
* マウスを使って入力する

Creating the reference with the mouse
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#. 参照元セルをクリックする
#. 数式バー左の :guilabel:`+` アイコンをクリックする
#. 参照先セルを含むシートに対するシートタブをクリックする
#. 参照先セルをクリックする
#. 数式バー左の :guilabel:`✓` アイコンをクリックする

Creating the reference with the keyboard
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

マウス操作手順で最終的に参照元セルに現れる数式と同じ文字列をキーボードで直接入力
する。

Protect spreadsheet structure
----------------------------------------------------------------------

文書のシート構成に満足したら、次のシート操作を禁止したい：

* シートを追加
* シートを削除
* シートの順序を変更
* シートの名前を変更

このためには、メニューの :menuselection:`&Tools --> Protect &Spreadsheet
Structure...` を実行して構造を固定する。パスワード入力ダイアログボックスが開く。
パスワードを適当に入力して :guilabel:`&OK` を押す。上記の操作が不可になる。

シート操作を解禁するにはこのコマンドを再度実行し、指定のパスワードを入力して
:guilabel:`&OK` を押す。

Referencing other documents
======================================================================

Creating the reference with the mouse
----------------------------------------------------------------------

マウスを使って参照を作成するには、スプレッドシートを両方開いておく必要がある。

#. 数式を入力するセルを含むほうのスプレッドシートに切り替える。
#. 数式を入力するセルを選択する。
#. 数式バーの左にある :guilabel:`=` アイコンをクリックする。
#. もう一方のスプレッドシートに切り替える。
#. 参照先シートを選択し、参照先セルを選択する。この時点で :kbd:`Enter` を押せば
   確定。
#. 参照元シートに切り替えて数式バーの左にある :guilabel:`✓` アイコンをクリックす
   る。

以上の手順により、セルの内容が適切な参照式になる。

Creating the reference with the keyboard
----------------------------------------------------------------------

参照元セルの内容として、参照先セルに対する参照式を直接入力すればいい。次のような
数式となるはずだ：

   :samp:`='file://{/path/to/ods}'#$'{SheetName}'.CellReference`

Using hyperlinks and URLs
======================================================================

スプレッドシート内から別の場所にジャンプするためにハイパーリンクを使用する。次の
ジャンプ先が実現可能だ：

* 現在のファイルの他の部分
* 別のファイル
* Web ページ

Relative and absolute hyperlinks
----------------------------------------------------------------------

ファイル内ハイパーリンクは相対パスまたは絶対パスのどちらかだ。

* 絶対リンクは対象が移動すると機能しなくなる。
* 相対リンクは開始位置と対象位置が相対的に変わると機能しなくなる。

設定ダイアログの :menuselection:`Load/Save --> General` 以下に関連オプション項目
アリ。

* ファイルリンクには相対リンクを使うのがよい。
* 相対リンクは、作業中のファイルがリンク先と同じドライブにある場合に限り可能。
* Calc は内部的に絶対パス名を使用するので、ハイパーリンク上にマウスポインタを置
  くと、ツールチップには絶対参照が示される。

Creating hyperlinks
----------------------------------------------------------------------

スプレッドシートにハイパーリンクを挿入する方法は複数ある：

* セルまたはセル内のテキストを選択し、またはキャレットを挿入位置に置き、

  * メニューから :menuselection:`&Insert --> Hyperlink...` を実行するか、
  * キーバインド :kbd:`Ctrl` + :kbd:`K` を押して、

  :guilabel:`Hyperlink` ダイアログボックスを開く。
* Navigator ウィンドウ (:kbd:`F5`) からハイパーリンクを挿入したい箇所（シートタ
  ブやセルなど）に項目をドラッグ＆ドロップする。
* ハイパーリンクを挿入する場所に対象の URL を入力する。

入力文字列をハイパーリンク URL として Calc に自動認識させるには、メニューから
:menuselection:`&Tools --> &AutoCorrect Options...` を実行して、ダイアログボック
ス内の :guilabel:`Options` タブで :guilabel:`URL Recognition` をオンにする。

ハイパーリンクの色を変更するには、設定ダイアログ :menuselection:`LibreOffice -->
Application Colors` の次の項目の色を指定しろ：

* Unvisited links
* Visited links

Opening hyperlinks
----------------------------------------------------------------------

ハイパーリンクからジャンプする方法は、ホットテキストの場合は：

* 左クリックか、または :kbd:`Ctrl` を押しながら左クリックのいずれか
* 右クリックメニューから :menuselection:`&Open Hyperlink` を実行する

ことでジャンプする。左クリック絡みは設定ダイアログ :guilabel:`LibreOffice -->
Security` における:guilabel:`Security Options and Warnings` ダイアログボックスで
の項目:guilabel:`Ctrl-click required &to open hyperlinks` の状態によってどちらの
操作が有効であるかが決まる。

ボタンの場合は、Design Mode に入っていない場合には左クリックでジャンプ。Design
Mode へするには、次のいずれかのツールバーの :guilabel:`Design Mode` をオンにす
る：

* :menuselection:`&View --> Toolbars --> For&m Controls`
* :menuselection:`&View --> Toolbars --> Form Desi&gn`

Hyperlink dialog
----------------------------------------------------------------------

:menuselection:`&Insert --> Hyperlink...` 実行などの操作で開くダイアログボックス
の説明。

* 利用しそうなのは :guilabel:`Web` か :guilabel:`Document` しかない。

Editing hyperlinks
----------------------------------------------------------------------

既存のホットテキストに対するハイパーリンクを編集する方法はいくつかある：

* ホットテキストを含むセルをクリックし、:menuselection:`&Insert Hyperlink...` を
  実行するか、同等の操作を行う。
* ホットテキストを選択して右クリックメニュー :menuselection:`&Edit Hyperlink...`
  を実行する。

既存のボタンに対するハイパーリンクの場合、参照先を編集するにはスプレッドシートの
Form Design Mode が有効である必要がある。ボタンを選択した状態で：

* :menuselection:`&Insert Hyperlink...` を実行するか、同等の操作を行う。
* 右クリックメニュー :menuselection:`Con&trol Properties...` を実行し、
  :guilabel:`&Label` にある参照先を表す文字列を変更する。

複数のハイパーリンクを編集する場合、すべてを編集するまで :guilabel:`Hyperlink`
ダイアログボックスを開いたままにしておくことが可能。適宜 :guilabel:`&Apply` ボタ
ンを押せ。

Removing hyperlinks
----------------------------------------------------------------------

ホットテキストの場合は文字列を選択して右クリックメニューから
:menuselection:`&Remove Hyperlink` を実行しろ。ボタンの場合は編集時と同じ。

Linking to external data
======================================================================

他の文書のデータをリンクとしてスプレッドシートに挿入可能。

ファイルに名前付き範囲、データベース範囲、名前付きテーブルなどがあり、リンクした
い範囲やテーブルの名前がわかっている場合は、外部データダイアログを使う方法が早
い。

注意：リンク先のファイルの保存場所によっては、更新処理が完了するまでに数分かかる
ことがある。

Using the External Data dialog
----------------------------------------------------------------------

   The :guilabel:`External Data` dialog inserts data from an HTML, Calc,
   :abbr:`CSV (Comma-Separated Values)`, or Microsoft Excel file into the
   current sheet as a link. Calc utilizes a Web Page Query import filter,
   enabling you to insert tables from HTML documents.

この操作をインポートと便宜上呼ぶことにする。インポートの手順は：

#. 外部データインポート先となる ods ファイルを開く
#. インポート先セル範囲の左上セルを選択する
#. メニューから :menuselection:`&Sheet --> E&xternal Links...` を実行

ここで :guilabel:`External Data` ダイアログボックスが開く。

* :guilabel:`URL of &External Data Source` に場所を入力するか、
* ドロップダウンリストから項目を選択するか、
* :guilabel:`Browse` ボタンからアクセスできるファイル選択ダイアログ

からインポート元を選択しろ。インポート元のデータ種別により、以降 UI の挙動が異な
る。

* HTML ファイルを選択した場合、本書参照。
* CSV ファイルを選択した場合、:guilabel:`Text Import` ダイアログボックスが現れ
  る。Chapter 1 で述べられている手順に合流する。
* Calc または MS Excelファイルを選択した場合、インポート元に定義されている範囲名
  とデータベース範囲の一覧がダイアログの :guilabel:`&Available Tables/Ranges`
  に埋まる。挿入したい項目を選択しろ。

インポートにより、Navigator ウィンドウの :guilabel:`Linked areas` 欄に新しい項目
が追加する。このような項目を

* ダブルクリックするとシート内のリンクされたデータが強調表示される。
* マウスホバーするとツールチップにリンクされたデータのパスが表示される。

スプレッドシート内のすべての外部データリンクを一覧表示するには、メニュー
:menuselection:`&Edit --> Lin&ks to External Files...` を実行する。ダイアログ
ボックス :guilabel:`Edit Links` が開く。一般には、一覧の一部が外部リンクだ。

Using the Navigator
----------------------------------------------------------------------

#. インポート先スプレッドシートを開く。
#. インポート元ファイルを開く（上述のファイル形式が有効）。
#. インポート先で Navigator ウィンドウを開く。:kbd:`F5` 押しが早い。
#. Navigator ウィンドウ下部のドロップダウンリストからインポート元を選択する。
#. 必要な範囲名またはデータベース範囲項目を選択し、Navigator ウィンドウからイン
   ポート先シートにドラッグして、データ範囲の左上のセルに移動する。

How to find the required data range or table
----------------------------------------------------------------------

* :guilabel:`HTML_all`: HTML ファイル全体を指定
* :guilabel:`HTML_tables`: HTML ファイル内のテーブルすべてを指定

``TABLE`` 要素に ``ID`` 属性がある場合、連番を付けた範囲と共に、それらの属性値が
範囲名一覧に表示される。

そういう属性値がないインポート元については強調表示機能頼みになる。

Linking to registered data sources
======================================================================

Viewing data sources
----------------------------------------------------------------------

Editing data sources
----------------------------------------------------------------------

Launching Base to work on data sources
----------------------------------------------------------------------

Using data sources in Calc spreadsheets
----------------------------------------------------------------------

Embedding spreadsheets
======================================================================

Object Linking and Embedding (OLE)
----------------------------------------------------------------------

Other OLE objects
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Non-linked OLE object
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Linked OLE object
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Dynamic Data Exchange (DDE)
----------------------------------------------------------------------

DDE link in Calc
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

DDE link in Writer
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

XML Source
======================================================================

